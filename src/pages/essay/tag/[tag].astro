---
import { getCollection } from 'astro:content'
import DefaultLayout from '../../../layouts/Default.layout.astro'

export async function getStaticPaths() {
  const essayEntries = await getCollection('essay')

  const tagsMap = essayEntries.reduce((acc, cur) => {
    cur.data.tags.forEach((tag) => {
      acc[tag] || (acc[tag] = [])
      acc[tag].push(cur)
    })
    return acc
  }, {})

  return Object.keys(tagsMap).map(tag => ({
    params: { tag },
    props: { entries: tagsMap[tag] },
  }))
}

const { entries: essays } = Astro.props
---
<DefaultLayout>
  <ul>
    {essays.map(essay => (
      <li
        data-slug={essay.slug}
        class="flex justify-between items-center"
      >
        <a
          class="unset hover"
          href={`/essay/detail/${essay.slug}`}
        >{essay.data.title}</a>

        <span
          class="italic"
          style="color: var(--color-text-muted);"
        >{
          new Date(essay.data.date).toLocaleDateString()
          || 'æ— '
        }</span>
      </li>
    ))}
  </ul>
</DefaultLayout>
